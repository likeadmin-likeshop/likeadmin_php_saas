import{A as W,g as X,r as Y,q as h,S as ee,L as le,M as oe,B as te,N as se,T as ae,f as ne,C as ue}from"./element-plus-CSiqOtzA.js";import{h as de,i as ie,b as re,j as pe,M as f,k as me,t as fe}from"./index-C9QhjZtv.js";import{d as D,r as M,s as R,Z as z,b as G,w as ce,n as q,f as ve,o as m,c as U,V as t,M as s,u as l,L as V,U as F,S as b,a,a3 as I,aa as P,P as Ve,T as be,R as y}from"./@vue-TMcuEboY.js";import{c as _e}from"./@vueuse-DE_336rM.js";import{b as ye,c as ke,d as ge,e as Ue}from"./menu-DlsJ0x7x.js";import{P as we}from"./index-CfFOeN-h.js";const Te={class:"icon-select"},Ee={class:"flex justify-between"},xe=["onClick"],Ce={class:"h-[280px]"},Ne={class:"flex flex-wrap"},Me={key:0,class:"flex items-center"},Be=D({__name:"picker",props:{modelValue:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(j,{emit:B}){const w=B,T=M(0),E=[{name:"element图标",icons:de()},{name:"本地图标",icons:ie()}],k=R(),n=z({inputValue:"",popoverVisible:!1,popoverWidth:0,mouseoverSelect:!1,inputFocus:!1}),L=()=>{n.inputFocus=n.popoverVisible=!0},C=()=>{n.inputFocus=!1,n.popoverVisible=n.mouseoverSelect},S=i=>{n.mouseoverSelect=n.popoverVisible=!1,w("update:modelValue",i),w("change",i)},o=()=>{w("update:modelValue",""),w("change","")},$=G(()=>{var v;const i=((v=E[T.value])==null?void 0:v.icons)??[];if(!n.inputValue)return i;const d=n.inputValue.toLowerCase();return i.filter(g=>{if(g.toLowerCase().indexOf(d)!==-1)return g})}),N=()=>{q(()=>{var d;const i=(d=k.value)==null?void 0:d.$el.offsetWidth;n.popoverWidth=i<300?300:i})};return _e(document.body,"click",()=>{n.popoverVisible=!!(n.inputFocus||n.mouseoverSelect)}),ce(()=>n.popoverVisible,async i=>{var d,v;await q(),i?(d=k.value)==null||d.focus():(v=k.value)==null||v.blur()}),ve(()=>{N()}),(i,d)=>{const v=re,g=X,O=Y,A=h,r=ee;return m(),U("div",Te,[t(r,{trigger:"contextmenu",visible:n.popoverVisible,"onUpdate:visible":d[3]||(d[3]=e=>n.popoverVisible=e),width:n.popoverWidth},{reference:s(()=>[t(l(W),{ref_key:"inputRef",ref:k,modelValue:n.inputValue,"onUpdate:modelValue":d[2]||(d[2]=e=>n.inputValue=e),modelModifiers:{trim:!0},placeholder:"搜索图标",autofocus:!1,disabled:i.disabled,onFocus:L,onBlur:C,clearable:""},{prepend:s(()=>[i.modelValue?(m(),U("div",Me,[t(A,{class:"flex-1 w-20",content:i.modelValue,placement:"top"},{default:s(()=>[(m(),V(v,{class:"mr-1",key:i.modelValue,name:i.modelValue,size:16},null,8,["name"]))]),_:1},8,["content"])])):(m(),U(F,{key:1},[b("无")],64))]),append:s(()=>[t(g,null,{default:s(()=>[t(v,{name:"el-icon-Close",size:18,onClick:o})]),_:1})]),_:1},8,["modelValue","disabled"])]),default:s(()=>[a("div",{onMouseover:d[0]||(d[0]=I(e=>n.mouseoverSelect=!0,["stop"])),onMouseout:d[1]||(d[1]=I(e=>n.mouseoverSelect=!1,["stop"]))},[a("div",null,[a("div",Ee,[d[4]||(d[4]=a("div",{class:"mb-3"},"请选择图标",-1)),a("div",null,[(m(),U(F,null,P(E,(e,p)=>a("span",{key:p,class:Ve(["cursor-pointer text-sm ml-2",{"text-primary":p==l(T)}]),onClick:_=>T.value=p},be(e.name),11,xe)),64))])]),a("div",Ce,[t(O,null,{default:s(()=>[a("div",Ne,[(m(!0),U(F,null,P($.value,e=>(m(),U("div",{key:e,class:"m-1"},[t(g,{onClick:p=>S(e)},{default:s(()=>[t(v,{name:e,size:18},null,8,["name"])]),_:2},1032,["onClick"])]))),128))])]),_:1})])])],32)]),_:1},8,["visible","width"])])}}}),Le={class:"edit-popup"},Se={class:"flex-1"},$e={class:"flex-1"},Oe={class:"flex-1"},Ae={class:"flex-1"},Fe={class:"flex-1"},ze=D({__name:"edit",emits:["success","close"],setup(j,{expose:B,emit:w}){const T=w,E=R(),k=R(),n=M("add"),L=G(()=>n.value=="edit"?"编辑菜单":"新增菜单"),C=M(pe()),S=(r,e)=>{const p=r?C.value.filter(_=>_.toLowerCase().includes(r.toLowerCase())):C.value;e(p.map(_=>({value:_})))},o=z({id:"",pid:0,type:f.CATALOGUE,icon:"",name:"",sort:0,paths:"",perms:"",component:"",selected:"",params:"",is_cache:1,is_show:1,is_disable:0}),$={pid:[{required:!0,message:"请选择父级菜单",trigger:["blur","change"]}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],paths:[{required:!0,message:"请输入路由地址",trigger:"blur"}],component:[{required:!0,message:"请输入组件地址",trigger:"blur"}]},N=M([]),i=async()=>{const r=await ye({page_type:0}),e={id:0,name:"顶级",children:[]};e.children=me(fe(r.lists).filter(p=>p.type!=f.BUTTON)),N.value.push(e)},d=async()=>{var r,e;await((r=E.value)==null?void 0:r.validate()),n.value=="edit"?await ke(o):await ge(o),(e=k.value)==null||e.close(),T("success")},v=(r="add")=>{var e;n.value=r,(e=k.value)==null||e.open()},g=r=>{for(const e in o)r[e]!=null&&r[e]!=null&&(o[e]=r[e])},O=async r=>{const e=await Ue({id:r.id});g(e)},A=()=>{T("close")};return i(),B({open:v,setFormData:g,getDetail:O}),(r,e)=>{const p=le,_=oe,c=te,K=se,x=W,Z=Be,H=ae,J=ne,Q=ue;return m(),U("div",Le,[t(we,{ref_key:"popupRef",ref:k,title:l(L),async:!0,width:"550px",onConfirm:d,onClose:A},{default:s(()=>[t(Q,{ref_key:"formRef",ref:E,model:l(o),"label-width":"80px",rules:$},{default:s(()=>[t(c,{label:"菜单类型",prop:"type",required:""},{default:s(()=>[t(_,{modelValue:l(o).type,"onUpdate:modelValue":e[0]||(e[0]=u=>l(o).type=u)},{default:s(()=>[t(p,{value:l(f).CATALOGUE},{default:s(()=>e[13]||(e[13]=[b("目录")])),_:1},8,["value"]),t(p,{value:l(f).MENU},{default:s(()=>e[14]||(e[14]=[b("菜单")])),_:1},8,["value"]),t(p,{value:l(f).BUTTON},{default:s(()=>e[15]||(e[15]=[b("按钮")])),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"父级菜单",prop:"pid"},{default:s(()=>[t(K,{class:"flex-1",modelValue:l(o).pid,"onUpdate:modelValue":e[1]||(e[1]=u=>l(o).pid=u),data:l(N),clearable:"","node-key":"id",props:{label:"name"},"default-expand-all":!0,placeholder:"请选择父级菜单","check-strictly":""},null,8,["modelValue","data"])]),_:1}),t(c,{label:"菜单名称",prop:"name"},{default:s(()=>[t(x,{modelValue:l(o).name,"onUpdate:modelValue":e[2]||(e[2]=u=>l(o).name=u),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1}),l(o).type!=l(f).BUTTON?(m(),V(c,{key:0,label:"菜单图标",prop:"icon"},{default:s(()=>[t(Z,{class:"flex-1",modelValue:l(o).icon,"onUpdate:modelValue":e[3]||(e[3]=u=>l(o).icon=u)},null,8,["modelValue"])]),_:1})):y("",!0),l(o).type!=l(f).BUTTON?(m(),V(c,{key:1,label:"路由路径",prop:"paths"},{default:s(()=>[a("div",Se,[t(x,{modelValue:l(o).paths,"onUpdate:modelValue":e[4]||(e[4]=u=>l(o).paths=u),placeholder:"请输入路由路径",clearable:""},null,8,["modelValue"]),e[16]||(e[16]=a("div",{class:"form-tips"}," 访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头 ",-1))])]),_:1})):y("",!0),l(o).type==l(f).MENU?(m(),V(c,{key:2,label:"组件路径",prop:"component"},{default:s(()=>[a("div",$e,[t(H,{class:"w-full",modelValue:l(o).component,"onUpdate:modelValue":e[5]||(e[5]=u=>l(o).component=u),"fetch-suggestions":S,clearable:"",placeholder:"请输入组件路径"},null,8,["modelValue"]),e[17]||(e[17]=a("div",{class:"form-tips"}," 访问的组件路径，如：`user/setting`，默认在`views`目录下 ",-1))])]),_:1})):y("",!0),l(o).type==l(f).MENU?(m(),V(c,{key:3,label:"选中菜单",prop:"selected"},{default:s(()=>[a("div",Oe,[t(x,{modelValue:l(o).selected,"onUpdate:modelValue":e[6]||(e[6]=u=>l(o).selected=u),placeholder:"请输入路由路径",clearable:""},null,8,["modelValue"]),e[18]||(e[18]=a("div",{class:"form-tips"}," 访问详情页面，编辑页面时，菜单高亮显示，如`/consumer/lists` ",-1))])]),_:1})):y("",!0),l(o).type!=l(f).CATALOGUE?(m(),V(c,{key:4,label:"权限字符",prop:"perms"},{default:s(()=>[a("div",Ae,[t(x,{modelValue:l(o).perms,"onUpdate:modelValue":e[7]||(e[7]=u=>l(o).perms=u),placeholder:"请输入权限字符",clearable:""},null,8,["modelValue"]),e[19]||(e[19]=a("div",{class:"form-tips"}," 将作为server端API验权使用，如`auth.admin/user`，请谨慎修改 ",-1))])]),_:1})):y("",!0),l(o).type==l(f).MENU?(m(),V(c,{key:5,label:"路由参数",prop:"params"},{default:s(()=>[a("div",null,[a("div",Fe,[t(x,{modelValue:l(o).params,"onUpdate:modelValue":e[8]||(e[8]=u=>l(o).params=u),placeholder:"请输入路由参数",clearable:""},null,8,["modelValue"])]),e[20]||(e[20]=a("div",{class:"form-tips"},' 访问路由的默认传递参数，如：`{"id": 1, "name": "admin"}`或`id=1&name=admin` ',-1))])]),_:1})):y("",!0),l(o).type==l(f).MENU?(m(),V(c,{key:6,label:"是否缓存",prop:"is_cache",required:""},{default:s(()=>[a("div",null,[t(_,{modelValue:l(o).is_cache,"onUpdate:modelValue":e[9]||(e[9]=u=>l(o).is_cache=u)},{default:s(()=>[t(p,{value:1},{default:s(()=>e[21]||(e[21]=[b("缓存")])),_:1}),t(p,{value:0},{default:s(()=>e[22]||(e[22]=[b("不缓存")])),_:1})]),_:1},8,["modelValue"]),e[23]||(e[23]=a("div",{class:"form-tips"},"选择缓存则会被`keep-alive`缓存",-1))])]),_:1})):y("",!0),l(o).type!=l(f).BUTTON?(m(),V(c,{key:7,label:"是否显示",prop:"is_show",required:""},{default:s(()=>[a("div",null,[t(_,{modelValue:l(o).is_show,"onUpdate:modelValue":e[10]||(e[10]=u=>l(o).is_show=u)},{default:s(()=>[t(p,{value:1},{default:s(()=>e[24]||(e[24]=[b("显示")])),_:1}),t(p,{value:0},{default:s(()=>e[25]||(e[25]=[b("隐藏")])),_:1})]),_:1},8,["modelValue"]),e[26]||(e[26]=a("div",{class:"form-tips"}," 选择隐藏则路由将不会出现在侧边栏，但仍然可以访问 ",-1))])]),_:1})):y("",!0),l(o).type!=l(f).BUTTON?(m(),V(c,{key:8,label:"菜单状态",prop:"is_disable",required:""},{default:s(()=>[a("div",null,[t(_,{modelValue:l(o).is_disable,"onUpdate:modelValue":e[11]||(e[11]=u=>l(o).is_disable=u)},{default:s(()=>[t(p,{value:0},{default:s(()=>e[27]||(e[27]=[b("正常")])),_:1}),t(p,{value:1},{default:s(()=>e[28]||(e[28]=[b("停用")])),_:1})]),_:1},8,["modelValue"]),e[29]||(e[29]=a("div",{class:"form-tips"},"选择停用则路由将不会出现在侧边栏，也不能被访问",-1))])]),_:1})):y("",!0),t(c,{label:"菜单排序",prop:"sort"},{default:s(()=>[a("div",null,[t(J,{modelValue:l(o).sort,"onUpdate:modelValue":e[12]||(e[12]=u=>l(o).sort=u),min:0,max:9999},null,8,["modelValue"]),e[30]||(e[30]=a("div",{class:"form-tips"},"数值越大越排前",-1))])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])])}}});export{ze as _};
